---
sidebar_position: 24
---


# U77-78 新知和技術



##  切換狀態：完成/未完成
1. 在 todo model 新增「完成狀態 (done)」的欄位
2. 在 index、detail 與 edit 樣板中新增 checkbox
3. 修改路由，讓使用者能透過「打勾」來更新 todo 的完成狀態


## 在 todo model 新增「完成狀態 (done)」的欄位
1. 在應用程式層級上，設定特定集合的schema，其schema會增加一個屬性名為isDone來存每一個todo的完成狀態，isDone值型別會是布林值(Boolean)，且預設值為false，內容如下：

```
const mongoose = require('mongoose')
const Schema = mongoose.Schema
const todoSchema = new Schema({
  name: {
    type: String,
    required: true
  },
  // 若沒新增或者沒有設定該值的話，isDone會被設定成false
  isDone: { 
    type: Boolean,              
    default: false  // 預設完成狀態為 false 
  }
})
module.exports = mongoose.model('Todo', todoSchema)
```

2. 這屬性來對應checkbox的勾選狀態，若勾選狀態為on時，就代表著todo的完成狀態就是true，否則皆為false


## 在 index、detail 與 edit 樣板中新增 checkbox
1. 在這裡會設定只有edit樣板能夠修改和讀取checkbox和每一個todo的完成狀態，剩下的index和detail則只能讀取checkbox和完成狀態：

2. index ：
	- 能否編輯：不能
	- 能否讀取：能
3. detail：
	- 能否編輯：不能
	- 能否讀取：能

4. edit：
	- 能否編輯：能
	- 能否讀取：能

5. 所有能編輯和讀取的樣版會多增加下列程式碼，這裡的if是只有todo.isDone為true時才會顯示checked(已勾選的狀態)
```
<input type="checkbox" name="isDone" {{#if todo.isDone}} checked {{/if}}>
```

6. 所有只能讀取且不能編輯的樣版會多增加下列程式碼，大致上與第五項雷同，但不同的是會增加disabled來阻止被編輯。
```
<input type="checkbox" name="isDone" {{#if this.isDone }} checked {{/if}} disabled>
```


## 修改路由，讓使用者能透過「打勾」來更新 todo 的完成狀態

```
app.post('/todos/:id/edit', (req, res) => {
  const id = req.params.id
  const { name, isDone } = req.body
  return Todo.findById(id)
    .then(todo => {
      todo.name = name
      todo.isDone = isDone === 'on'
      return todo.save()
    })
    .then(() => res.redirect(`/todos/${id}`))
    .catch(error => console.log(error))
})
```