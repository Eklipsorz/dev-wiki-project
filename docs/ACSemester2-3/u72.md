---
sidebar_position: 20
---


# U72 技術和新知


## require('express-handlebars')
1. 實際上的模組內容定義匯出內容為如下，require會回傳exphbs函式，而該函式可以不帶參數或者使用config物件一起被調用，exphbs本身會先按照ExpressHandlebars 來建立對應實體(create(config))，接著利用那實體本身的engine屬性來回傳，該屬性值正是主要實現engine功能的 function 或者被稱之為engine factory function，可以直接被被express app 註冊成engine factory function。其中config 物件主要就是express-handlebars設定，開發者可藉由建立該物件並傳入就即可依照config物件內容來呈現

```
const ExpressHandlebars = require("./lib/express-handlebars");

exports = module.exports = exphbs;
// -----------------------------------------------------------------------------

function exphbs (config) {
  return create(config).engine;
}

function create (config) {
  return new ExpressHandlebars(config);
}
```


2. create (config)是用以建立ExpressHandlebars 實體的 factory function，create裡頭的參數會是config物件，ExpressHandlebars 實體會依照config物件內容來建立，而ExpressHandlebars 代表著handlebars本身，而該實體具有可以進一步控制/獲取handlebar的相關設定、執行方式、額外渲染檔案，如engine、compiled、getPartials、getTemplate。



## ExpressHandlebars 的 engine
1. 該engine方法會是綁定於該實體的renderView的function reference，該renderView正是主要實現engine功能的 function 或者被稱之為engine factory function。
```
// Express view engine integration point.
this.engine = this.renderView.bind(this);

async renderView (viewPath, options = {}, callback = null) {
  .
  .
  .
}
```

## configs object
1. 主要定義ExpressHandlebars設定的物件，其屬性值為ExpressHandlebars的設定值
2. 主要有layoutsDir、defaultLayout、extname 
3. layoutsDir 設定layouts的位置，讓handlebars知道在哪可以取得layouts，預設是express settings.view + layouts/ 或者view目錄下的layouts目錄
4. defaultLayout 設定預設佈局，預設會是main
5. extname 指定能讓handlebars辨識的副檔名，告訴哪些副檔名才是它能夠解析和執行，預設為.handlebars，若要更改其他的副檔名以.和想要娶的副檔名即可，比如hbs，就設定extname:'.hbs'


## app.engine載入引擎的方式：
1. app.engine本身設定(如下)，ext為字串，是指模板檔案的副檔名，callback 為函式物件，是渲染引擎負責渲染的程式
```
app.engine(ext, callback)
```
2. 主要作用是將callback以ext的名稱來註冊引擎名稱，接著再使用著app.set('view engine', ext)來宣告引擎是哪個引擎名稱就能讓express辨識副檔名。

3. 而app.engine載入代表引擎的callback，有三種方式：
  - 不直接建立Handlebars實體，而不帶參數再入：不帶參數就表示以預設設定值來建立Handlebars實體並利用其engine方法來當作其引擎的callback
  ```
	const engine = require('express-handlebars')
	app.engine(ext, engine())
  ```
  - 不直接建立Handlebars實體，而使用config物件：以config物件所指示的設定來建立Handlebars實體並利用其engine方法來當作其引擎的callback
  ```
  const engine = require('express-handlebars')
	app.engine(ext, engine({/* config object */} )  // {} 內就是config物件
  ```
  - 直接建立Handlebars實體，並且拿該實體下的engine方法來載入：透過require回傳的函式所擁有的方法-create，而create再搭配config物件就能建立Handlebars實體，最後再以該實體的engine方法來當作其引擎的callback
  ```
	const handlebars = require(‘express-handlebars’).create({ /* config object */ })
	app.engine(ext, handlebars.engine)
  ```