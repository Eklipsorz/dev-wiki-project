---
sidebar_position: 14
---

# u36 知識&技術


## 實作FB登入認證
1. 分為兩大步驟：
  - 串接 Facebook，取得第三方資料
  - 運用 Facebook 資訊完成 FacebookStrategy 登入

## 串接 Facebook，取得第三方資料
1. 先至Facebook for developers 網站註冊申請使用FB登入認證的API，同時記住申請成功後所獲得的client ID和client secret
2. 安裝 Passport-Facebook
```
npm install passport-facebook
```
3. 在自己專案中新增Facebook登入策略：
```
// 註冊一個FB登入策略給passport.js
passport.use(new FacebookStrategy({
    // 設定FB Client ID是為何
    clientID: FACEBOOK_APP_ID,
    // 設定FB Client 密鑰是為何
    clientSecret: FACEBOOK_APP_SECRET,
    // 設定登入並確定授權範圍後，使用者被導向的位置
    callbackURL: "http://localhost:3000/auth/facebook/callback”,
   // 設定Web App要哪些資料
    profileFields: ['email’, ‘displayName’]
  }, (accessToken, refreshToken, profile, done) => {
	  
    // 定義FB認證策略
  }))


```



## FB登入策略實際運作

1. 當使用者按下Sign in with facebook這按鈕時，便代表發送GET /auth/facebook請求至Web Application，而Web Application的對應路由(路由清單上的第一個項目)會呼叫


來定義其應用程式想要哪一種資料並以scope來存放，同時間由於

```
// /auth的路由清單
router.get('/facebook', passport.authenticate('facebook', {
  scope: ['email', 'public_profile']
}))

router.get('/facebook/callback', passport.authenticate('facebook', {
  successRedirect: '/',
  failureRedirect: '/users/login'
}))
```

```
// FB登入策略的註冊

passport.use(new FacebookStrategy({
    // 設定FB Client ID是為何
    clientID: FACEBOOK_APP_ID,
    // 設定FB Client 密鑰是為何
    clientSecret: FACEBOOK_APP_SECRET,
    // 設定登入並確定授權範圍後，使用者被導向的位置
    callbackURL: "http://localhost:3000/auth/facebook/callback”,
   // 設定Web App要哪些資料
    profileFields: ['email’, ‘displayName’]
  }, (accessToken, refreshToken, profile, done) => {
	  
    // 定義FB認證策略是為何
  }))


```