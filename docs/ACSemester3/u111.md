---
sidebar_position: 49
---

# u111 新知和技術 

## 加入 Header 與 Footer
1. 新增導覽列 Header
2. 新增 Footer
3. 調整畫面排版


### 加入導覽列 Header
根據使用者種類來區分出後台和前台的Header頁面，具體實現分法為將Header以partial template的形式保存，在裡面添加：
  - 能夠判斷使用者是否登入：若有使用者登入的話，就呈現專屬每位使用者畫面，若沒有就呈現一般Header樣式。
  - 使用者種類是否為管理員：若是管理員的話，就呈現一個專屬管理員後台畫面，若不是就呈現專屬一般使用者的畫面
  - 具體實現為先在views/partials建立名為header.hbs來將前面兩者包裝成partial，其內容如下，
```
<header>
  <nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-dark px-4">
    <div class="container-fluid">
      <a class="navbar-brand" href="/">餐廳評論網</a>
      <!-- 判斷是否有使用者登入 -->
      {{#if user}}
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
          aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <ul class="navbar-nav ms-auto mb-2 mb-md-0">
            
            <!-- 判斷使用者是否為管理員 -->
            {{#if user.isAdmin}}
              <li class="nav-item">
                <a href="/admin" class="nav-link">Admin 後台</a>
              </li>
            {{/if}}
            
            <!-- 顯示使用者帳號 -->
            <li class="nav-item d-inline-flex align-items-center">
              <span class="text-white nav-link">Hi, {{ user.email }}</span>
            </li>

            <!-- 呈現登出按鈕 -->
            <li class="nav-item">
              <a href="/logout"><button class="btn btn-outline-success my-sm-0 my-2">Logout</button></a>
            </li>
          </ul>
        </div>
      {{/if}}
    </div>
  </nav>
</header>
```
  - 以partial來將header.hbs插入至畫面：於views/layouts/main.hbs那邊插入
  ```
  {{> header}}
  <main role="main">
    <div class="album bg-light p-5">
      <div class="container">
        {{> message}}
        {{{body}}}
      </div>
    </div>
  </main>
  ```



### 建立 auth-helpers.js


第一個版本

在 view 樣板裡使用的變數，需要由 controller 主動傳進去，但就像之前設置 flash message 時提到的，作法是把變數設放到 res.locals 裡，讓所有的 view 都能存取，直覺的做法是這樣：
```
app.use((req, res, next) => {
  res.locals.success_messages = req.flash('success_messages')
  res.locals.error_messages = req.flash('error_messages')
  res.locals.user = req.user // 加這行
  next()
})
```

在有成功登入的狀況下，Passport 會回傳 user，因此我們可以透過 req.user 把這個 user 物件實例拿出來，取得登入中的使用者狀態 (是 admin？還是普通 user？帳號是什麼？)。

權責分離的作法
  - 將修改req.user的責任歸於另一個獨立程式，使app.js專注於如何啟動app，而非在app.js設定相關設定然後啟動app

  - 因此，我們打算開一個新的資料夾叫做 helpers：

因此，我們打算開一個新的資料夾叫做 helpers：
```
$ mkdir helpers
$ touch helpers/auth-helpers.js

```
並在裡面開一支檔案 auth-helpers.js，顧名思義它就是專門來幫我們處理各種和使用者身份驗證相關的事情：


```
const getUser = req => {
  return req.user || null
}
module.exports = {
  getUser
}
```

  目前我們的餐廳論壇規模還很小，你可能還感受不到特別包裝這一層有什麼好處。不過藉由這次機會，我們想跟你展示一組品質良好的程式碼裡面會有許多抽象化設計，這麼做可以讓程式的權責更分離、可讀性提升，這些優點未來要和他人協作時會變得很重要，希望你可以先將此觀念放在心上。