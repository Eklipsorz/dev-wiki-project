---
sidebar_position: 11
---

# U33 知識&技術

## Encoding、Hashing、Encryption
Encoding、Hashing、Encryption都代表著把資訊重新編碼的方法，但三者皆因用途不一樣而在稱呼上有所區別：
1. Encoding：定義為一種將資訊轉換成易於接收者理解以方便處理的編碼形式
2. Hashing：定義為一種藉由同一個資訊經過編碼而轉換成一樣且難以閱讀的密文的特性來驗證其資訊是否被人惡意竄改或者防止他人看懂其資訊的編碼形式，該編碼會輸出成難以解密的形式
3. Encryption：定義為一種將資訊轉換成只有擁有key的人才能看懂的密文之編碼形式，而key通常會一串token，通常會有兩組key分別為public key和private key，透過其中一種key來加密，而另一種key則是解密。


### 參考資料
[Encoding, Hashing, and Encryption: What’s the difference?](https://blog.cadre.net/encoding-hashing-and-encryption-whats-the-difference)

## 雜湊和加密的不同
1. 雜湊(Hashing)本身就只是單向加密方式，換言之，單向加密就是將明文資訊編碼成密文，但無法從密文轉換成原本的明文資訊
2. 加密(Encryption)本身是定義將資訊編碼成密文，但密文可以藉由某種方式將密文轉換成原本的明文資訊

## 密碼儲存問題
1. 當使用者在Web App註冊完自己的帳密時，伺服器通常會以明碼的形式來將帳密儲存在資料庫，好讓下次使用者使用時就能夠透過資料庫來認證，然而若資料庫被駭客入侵時，其資料會因為明碼的關係而讓駭客在第一時間得知每個帳號的密碼是什麼，進而讓駭客對這些使用者做出一些損害權益的事情，甚至會讓使用者質疑Web App的安全性，而影響商譽
2. 為了解決這問題，就有人提出將明碼密碼轉換成難以閱讀的密文形式來儲存在資料庫，而每次做比對驗證時，就會比對使用者輸入的密碼轉換後的密文是否和存在資料庫的對應資料一樣
3. 明碼密碼轉換成密文的方法：
  - 雜湊(hash)：透過一種輸出內容不可解密的加密演算法將資訊轉換成人類難以閱讀的雜湊值，每一個雜湊值都對應著原本雜湊前的明文資訊，而同一個明文資訊經過該演算法後，永遠只能獲取相同的雜湊值，利用這項特性來觀察資訊是否被人惡意竄改或者防止他人觀看明文資訊，比較經典的雜湊方法為 SHA256

4. 彩虹表問題：由於同一個明文資訊經過該演算法後會獲取相同的雜湊值，所以可以透過窮舉方法來列出所有可能的字串組合來丟進演算法獲取其雜湊值，並構成(字串1:雜湊值)來構成一行，慢慢地收集成擁有大量行數的彩虹表，為了解決這問題，有人就提出透過加鹽來搭配明文來獲取對應雜湊值的方法-bcrypt


## bcrypt
1. 設計原理就是把一個第三方難以取得的隨機字串搭配明文資訊來獲取對應的雜湊值，透過這樣特性，讓第三方無法單方面從明文資訊來窮舉出正確的雜湊值。
2. 在這裏上述的隨機字串在這定義為鹽巴，字串與明文資訊合併動作則是加鹽動作本身
3. 簡單範例：拿明文加密來當實作流程的範例，其流程為如下：

  - 伺服器生成一組隨機字串(鹽巴/salt)
  - 伺服器將明文密碼與隨機字串合併(合併行為稱為加鹽)：合併方式不單只是將隨機字串接在明文密碼之後，還有可能是之前或者把每一個隨機字串的字元挑出插入至明文中。
  - 伺服器將合併後的字串丟入hashing algorithm 來產生對應的雜湊密碼
  - 伺服器將對應的雜湊密碼存在對應使用者的密碼那，而鹽巴也會存放在伺服器內部或者其他第三方難以取得的地方
  - 
![](https://res.cloudinary.com/dqfxgtyoi/image/upload/v1640440519/blog/loginSystem/bcryptExample_zj3nu0.png)
// 此圖源自於AC，之後得自行修改

4. 伺服器拿雜湊密碼來做登入驗證：在這裡假設伺服器已經存好對應使用者的雜湊密碼
  - 當使用者使用密碼登入時，伺服器收到帳號和密碼並且獲取鹽巴來與密碼合併、生成雜湊密碼
  - 伺服器比對使用者輸入過來且轉換過來的雜湊密碼與資料庫比對對應使用者的雜湊密碼
  - 若一致的話，伺服器就允許使用者登入
  - 若不一致的話，伺服器就不允許使用者登入
![](https://res.cloudinary.com/dqfxgtyoi/image/upload/v1640448366/blog/loginSystem/loginValidation_gglnsf.png)
// 此圖源自於AC，之後得自行修改
5. bcrypt輸出的雜湊值格式為： Alg代表bcrypt 演算法的版本數，cost則是指定hash的次數，Salt 則是用來加密原本明文資訊的鹽巴，最後的Hash則是用該前面設定來做bcrypt的雜湊碼輸出最後結果
```
$2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy
\__/\/ \____________________/\_____________________________/
 Alg Cost      Salt                        Hash
```

6. bcrypt產生雜湊碼的流程會需要三個變數：cost、info(明文資訊)、salt(初始鹽巴)，最後輸出為雜湊碼，流程如下：首先會先拿目前獲取的salt和目前資料做合併，並產生對應的hash，然後透過每一次產生的hash來從中取得salt，並拿它與目前的hash做另一個hash，這樣子的動作直到特定次數。
```
// 先讓hash變數存入明文資訊
hash = info

// 按照cost來指定hash的次數
for (let count = 0; count < cost; count++) {
  // 利用目前的鹽巴和hash來產生一個鹽巴資料
 saltData = merge(hash, salt)
 // 將與鹽巴合併後的資料做bcrypt所指定的hashing算法，並得到新的雜湊碼(hash)
 hash = bcrypt(saltData)
 // 從新的雜湊碼中獲取新的鹽巴
 salt = getNewSalt(hash)
}

// 回傳最後結果
return hash
```