---
sidebar_position: 34
---

# u77 新知和技術 

## SQL JOIN
1. JOIN是一種子句，會透過兩張表(分別為Table1和Table2)下各紀錄的某些屬性之間關聯性來將紀錄組合在一起並構成暫時行的表格，過程並不會影響Table1和Table2所存下的紀錄。
2. 目的在於將原本資料表延伸成具有其他資料表的屬性來補充原本資料表的資訊，所以合併後的表格會具有Table1和Table2會有的屬性，比如Table1具有a1,a2,a3這三個屬性，而Table2具有b1,b2,b3這三種屬性，合併後的表格會有a1,a2,a3,b1,b2,b3這六種屬性。
3. 在這裏每一筆在Table1的紀錄A以及每一筆Table2的紀錄B會是以范恩圖的集合看待，不論是哪一種表格，每筆紀錄都大致分為兩種：
  - 自己所擁有的某屬性值(X/Y)能與對方表格下的另一個某屬性值(Y/X)相符
  - 自己所擁有的屬某屬性值(X/Y)不能夠與對方表格下的另一個某屬性值(Y/X)相符
![](https://res.cloudinary.com/dqfxgtyoi/image/upload/v1642362081/blog/database/join/table1table2_vaw5ge.png)

而若考量兩個表格下的**自己所擁有的某屬性值(X/Y)能與對方表格下的另一個某屬性值(Y/X)相符**的話，那些能與對方的屬性值相符的紀錄們可以構成范恩圖的交集，也就是下圖中的Table3'
![](https://res.cloudinary.com/dqfxgtyoi/image/upload/v1642362419/blog/database/join/intersectionTables_fblo1j.png)

4. 第一點提到的關聯性會是以兩個范恩圖上集合會有的互動來互動
  - Inner Join：選擇兩個表格中具有匹配值的紀錄來與Table1被匹配到的紀錄合併
  - Left Join：這裡的Left會是指Table 1，而Left Join是將合併結果以Table 1會有的紀錄為主，而Table 1的紀錄會有無法與Table 2匹配的紀錄A和能與Table 2匹配的紀錄A，在這裏無法與Table 2匹配的紀錄會是以NULL為主的紀錄來合併，而能與Table 2匹配的紀錄B則是將該紀錄B與對應的紀錄A合併成新的紀錄，結果會是如下，ResultA1-ResultA2是Table 1的紀錄，而ResultB1是Table 2的紀錄，其中ResultA1會是代表無法與Table 2匹配的紀錄，與它合併的紀錄會是NULL，剩下的ResultA2會是代表能與Table 2匹配的紀錄A，與它合併的紀錄會是ResultB1
  ![](https://res.cloudinary.com/dqfxgtyoi/image/upload/v1642410341/blog/database/join/leftJoinResult_zec9kn.png)
  - Right Join：這裏Right會是指Table 2，而Right Join是將合併結果以Table 2會有的紀錄為主，而Table 2的紀錄會有無法與Table 1匹配的紀錄B和能與Table 1匹配的紀錄B，在這裏無法與Table 1匹配的紀錄會是以NULL為主的紀錄來合併，而能與Table 1匹配的紀錄A則是該紀錄A與對應的紀錄B合併成新的紀錄，結果會是如下，ResultA1是Table 1的紀錄，而ResultB1-ResultB2是Table 2的紀錄，其中ResultB1會是代表無法與Table 1匹配的紀錄B，與它合併的紀錄會是NULL，剩下的ResultB2會是代表能與Table 1匹配的紀錄B，與它合併的紀錄會是ResultA1

  ![](https://res.cloudinary.com/dqfxgtyoi/image/upload/v1642410246/blog/database/join/rightJoinResult_gyrgjk.png)
 
5. 在使用 JOIN 的時候，我們需要考慮到
  - 我要使用哪一種 JOIN？
  - JOIN 資料表跟資料表之間的參考點是什麼？(參考點為每一個要合併的表格所要比對的屬性，而比對就是比較是否一致並根據一致來合併新的紀錄)


## JOIN 案例設定
1. 分別設定飲料和訂單的Data Model並增加兩個表格，分別為代表飲料的drinks以及代表訂單的orders

```
// id 代表每個飲料的識別碼
// name 代表每個飲料的名稱
// price 代表每個飲料的價格
// cost 代表每個飲料的成本
// 設定id為主鍵
CREATE TABLE `drinks` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(10) NOT NULL,
  `price` INT UNSIGNED NOT NULL,
  `cost` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`id`)
);

// id 代表每個訂單的識別碼
// drink_id 代表著訂單內含的飲料(用飲料識別碼代表)
// customer_id 代表著訂單訂購者 (用客人識別碼代表)
// quantity 代表著內含的飲料數目
// createAt 代表訂單產生時間
// 設定id為主鍵

CREATE TABLE `orders` (
  `id` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `drink_id` INT UNSIGNED NOT NULL,
  `customer_id` INT UNSIGNED NOT NULL,
  `quantity` INT UNSIGNED NOT NULL,
  `createAt` TEXT NOT NULL,
  PRIMARY KEY (`id`)
);
```

2. 替drinks表格和orders表格增加幾筆資料

```
-- DRINKS
INSERT INTO `drinks` (`name`, `price`, `cost`)
VALUES ('阿華田', 65, 20);

INSERT INTO `drinks` (`name`, `price`, `cost`)
VALUES ('百香紅茶', 45, 10);

INSERT INTO `drinks` (`name`, `price`, `cost`)
VALUES ('四季春茶', 25, 5);


INSERT INTO `drinks` (`name`, `price`, `cost`)
VALUES ('愛玉冰茶', 50, 7);

INSERT INTO `drinks` (`name`, `price`, `cost`)
VALUES ('冰咖啡', 70, 30);

-- ORDERS

INSERT INTO `orders` (`drink_id`, `customer_id`, `amount`, `createAt`)
VALUES (1, 2, 4, '2019-07-14 13:55:56');

INSERT INTO `orders` (`drink_id`, `customer_id`, `amount`, `createAt`)
VALUES (2, 2, 3, '2019-07-14 14:21:23');

INSERT INTO `orders` (`drink_id`, `customer_id`, `amount`, `createAt`)
VALUES (3, 2, 9, '2019-07-14 14:26:12');

INSERT INTO `orders` (`drink_id`, `customer_id`, `amount`, `createAt`)
VALUES (3, 1, 2, '2019-07-14 18:51:50');
```

## SELF JOIN
1. 如同名字一樣，Table 1和Table 2 將會是同一個表格或者兩份相同的表格來做INNER JOIN
2. 由於比對的表格都是同一個，為了很好的操作表格，會使用AS來替每個相同的表格取一個別名
3. 案例1: 先將為名為employee表格取一個e1這個表格名稱，再將同樣的employee表格取一個e2這個表格名稱，接著以e1所擁有e1.deputy_employee_id屬性值去將對應的使用者資料合併過來，最後指定e1所有屬性和e2的員工名稱來印出來
```
SELECT e1.*, e2.name
FROM employee AS e1
JOIN employee AS e2
ON e1.deputy_employee_id = e2.id
```
4. 案例2: 先將為名為drinks取一個名為d1這個別名，再將同樣的drinks表格取一個d2這個表格名稱，接著透過WHERE將d1設定為只有一筆冰咖啡紀錄的表格，接著再用冰咖啡的價格去比對每一個d2的每一個價格是否滿足於d1.price > d2.price，若滿足就印出d1的產品名稱、比前者更便宜的產品名稱、對應產品的假ㄍㄡˊ
```
SELECT d1.name, d2.name as cheaper_name, d2.price
FROM drinks as d1
JOIN drinks as d2
ON d1.price > d2.price
WHERE d1.name = '冰咖啡';
```

## INNER JOIN 案例

1. 我們以代表訂單的orders作為Table 1，而代表飲料的drinks作為Table 2， 
```
SELECT * FROM `orders`
JOIN `drinks`
ON `orders`.`drink_id` = `drinks`.`id`
```
2. 

## LEFT JOIN
1. 



2. 
```
SELECT * FROM `orders`
LEFT JOIN `drinks` 
ON `orders`.`drink_id` = `drinks`.`id`
```





## RIGHT JOIN

1. 


2. 

```
SELECT * FROM `orders`
RIGHT JOIN `drinks` 
ON `orders`.`drink_id` = `drinks`.`id`
```