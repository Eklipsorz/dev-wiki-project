---
sidebar_position: 86
---

# u162的新知和技術


## 依條件切換按鈕

接下來我們希望在頁面上顯示出來的「加到最愛 / 移除最愛」按鈕，可以反應使用者的收藏狀態。頁面包含「餐廳論壇首頁」和「餐廳個別頁面」

![](https://res.cloudinary.com/dqfxgtyoi/image/upload/v1644407489/blog/deployment/toggle_ok_eb8a7a.gif)

### 初步構想
這個功能最主要的核心，是在瀏覽餐廳頁面時，判斷使用者是否已經收藏了某個特定的餐廳。

以下是我們對這個功能邏輯的初步想像，先把該使用者收藏的餐廳全部撈出來，然後比對特定餐廳是不是已經被登錄在這個列表裡，有的話就代表已經加入我的最愛，沒有的話就代表沒有。

研究完上述邏輯後，我們將實作步驟拆解成三步：

撈出使用者收藏清單
比對清單
依條件切換按鈕



通常include是指示目前modelX與哪個model做left outer join，而指定哪一種model的形式可以是：
  - model 名稱
  ```
  // 指定model2來做left outer join
  include: model2
  ```
  - 包含model屬性的物件，model是指定要哪一個model來做
  ```
  // 指定model2來做left outer join
  include: { 
    model: model2
  }
  ```
  - 包含model屬性和as屬性的物件，model是指定要哪一個model來做，假若前面指定的model與其他model之間存在著關聯並取了別名來表示其關係的話，那麼可以透過model和as來指明要哪一種關聯的model來與目前modelX做left outer join
  ```
  include: {
    model: model2, as: relationshipAlias
  }
  ```
  舉例來說，假設有三種表格分別為使用者、餐廳、收藏清單，其中收藏清單是餐廳本身



```
User.findByPk(id, {
    include: [
      { model: Restaurant, as: 'FavoritedRestaurants' }
    ]
  })
```


## 補充： association as 和 include as 
model本身對應著表格，表格之間總會有關聯(relation或者association)來對應，同樣的一對一對應關係、一對多對應關係、多對多對應關係會因為應用場景的不同而產生不同的關聯，比如說就拿使用者和餐廳之間是多對多關係的話，可以建構評論關聯：同個使用者可對多個餐廳作出評論，同個餐廳的評論可以由多個使用者來發出，除了評論關聯，還能是喜歡關聯：同個使用者可對多個餐廳作出喜歡，同個餐廳的喜歡可以由多個使用者來做出，從這能發現出同個多對多對應關係會因為場景而演變成評論關聯、喜歡關聯
1. 為了進一步根據場景來快速轉換成特定關聯處理，所以就使用了alias機制來為每個關聯做出命名、取別名，透過別名就能直接沿用對應關聯的設定和定義。



1. association as 是指 建構association所會用的as屬性，語法會是如下，功能是將modelA和modelB之間的association取上別名，以方便調整適合場景的關聯
```
modelA.association(modelB, {..., as: 'something'})
```