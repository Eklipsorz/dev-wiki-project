---
sidebar_position: 4
---

# 2022-4-25-開發日記


Javascript 

https://segmentfault.com/q/1010000008718054

super() => 指向於父類別的建構式，並用來建立該父類別的this 
每一個子類別(繼承類別的類別)本身沒有this變數，換言之，沒有辦法直接以子類別來建立實例，必須先建立父類別的實例，並用該實例來延伸屬性


cb(error, data) => callback會常以error first 為主的風格，在這個風格裡，第二個參數也時常是回傳的結果資料


安裝validator.js 
```
npm i validator
```
Validator 用途為按照通用字串驗證規則來驗證字串是否合法以及試著解決的模組



```
class APIError extends Error {
  constructor(options) {
    super(options)
    this.code = options.code
    // 這句不是多餘的，由於error只能接受字串，所以若是把陣列丟進去會強制轉換為字串，所以得在事後多設定陣列至message
    this.message = options.message
    this.status = options.status
    this.data = options.data
  }
}
```



將狀態分割成成功和失敗並獨立於/config/result-status-table.js ，讓整個專案載入該檔案，來按照數字來填入對應的代碼訊息，讓整體專案變得相當好讀取

```
const errorTable = {
  status: 'error',
  code: {
    BADREQUEST: 400,
    UNAUTHORIZED: 401,
    FORBIDDEN: 403,
    NOTFOUND: 404,
    SERVERERROR: 500
  }
}
const successTable = {
  status: 'success',
  code: {
    OK: 200
  }

}
exports = module.exports = {
  errorTable,
  successTable
}
```

成功訊息載入
```
const {
  status,
  code
} = require('../config/result-status-table').successTable

const userController = {
  login: (req, res, next) => {
    accountServices.login(req, 'users', (error, data, message) =>
      error ? next(error) : res.status(code.OK).json({ status, message, data })
    )
  },
}
```

失敗訊息載入
```
const {
  status,
  code
} = require('../config/result-status-table').errorTable

if (!account || !password) {
    return cb(new APIError({ code: code.FORBIDDEN, status, message: '未填寫完所有欄位' }))
}
```

/config/service.js
```
const accountService = {
  blackListRoleIn: {
    users: ['admin'],
    admin: ['user']
  }
}

exports = module.exports = {
  accountService
}
```


/services/account-service.js
```
const {
  blackListRoleIn
} = require('../config/service').accountService

const accountServices = {
  login: async (req, type, cb) => {
    if (!user || blackListRoleIn[type].includes(user.role)) {
        return cb(new APIError({ code: code.NOTFOUND, status, message: '帳號不存在' }))
    }
  }
}
```



/controllers/admin-controller.js
```
const adminController = {
  login: (req, res, next) => {
    accountServices.login(req, 'admin', (error, data, message) =>
      .....
    )
  }
}
```

/controllers/user-controller.js
```
const userController = {
  login: (req, res, next) => {
    accountServices.login(req, 'users', (error, data, message) =>
      .....
    )
  }
}
```